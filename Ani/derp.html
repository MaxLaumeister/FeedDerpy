<!doctype html>
	<html lang="en">
		<head>
			<meta charset="utf-8" />
			<title>Feed Derpy!</title>
			<style>
				body {
					position: absolute;
					margin: 0;
					width: 100%;
					height: 100%;
					overflow: hidden;
				}
				#muffinbutton {
					top: 50px;
				}
				#muffinbutton {
					position: relative;
					margin-left: auto;
					margin-right: auto;
					width: 200px;
					height: 100px;
					background: gray;
				}
				.muffin {
					position: absolute;
					width: 100px;
					height: 86px;
					display: block;
					margin-left: auto;
					margin-right: auto;
				}
				#outer {
					position: absolute;
					width: 100%;
					height: 464px;
					bottom: 0px;
				}
				#perch {
					padding-left: 50px;
					margin-left: auto;
					margin-right: auto;
					width: 600px;
					height: 464px;
				}
			</style>
			
		</head>
		<body id="theBody">
		<script type="text/javascript">
				var img_open = document.createElement('div');
				img_open.style.background = "url('open.gif')";
				img_open.id = "derpy";
				img_open.style.width = "600px";
				img_open.style.height = "464px";
				
				var img_close = new Image();
				img_close.src = "close.gif";
				img_close.id = "derpy";
				img_close.width = "600";
				img_close.height = "464";
				
				var img_closechew = new Image();
				img_closechew.src = "closechew.gif";
				img_closechew.id = "derpy";
				img_closechew.width = "600";
				img_closechew.height = "464";
				
				var img_idle = new Image();
				img_idle.src = "idle.gif";
				img_idle.id = "derpy";
				img_idle.width = "600";
				img_idle.height = "464";
				
				var newmuffin = function() {
					muffin_img = document.createElement("img");
					muffin_img.src = "muffin.png";
					muffin_img.width = "100";
					muffin_img.height = "86";
					muffin_img.className = "muffin";
					return muffin_img;
				}
				
				var muffin_count = 0;
				
				var open = false;
				var closed = false;
				var closechew = false;
				var idle = false;
				
				var clear = function() {
					open = false;
					closed = false;
					closechew = false;
					idle = false;
				}
				
				var busy = function() {
					return (open || closed || closechew);
				}
				
				var d_open = function() {
					if (muffin_count == 0 && !open) {
					
						var derpy = document.getElementById("derpy");
						derpy.parentNode.removeChild(derpy);
						console.log("open");
						img_open.style.background = img_open.style.background;
						document.getElementById("perch").appendChild(img_open);
						
						clear();
						open = true;
					}
				}
				
				var d_close = function() {
					if (muffin_count == 0 && open && !closechew) {
						
						var derpy = document.getElementById("derpy");
						derpy.parentNode.removeChild(derpy);
						document.getElementById("perch").appendChild(img_close);
						
						window.setTimeout(d_idle, 500);
						clear();
						closed = true;
					}
				}
				
				var d_closechew = function() {
					if (muffin_count == 0 && !idle) {
						
						var derpy = document.getElementById("derpy");
						derpy.parentNode.removeChild(derpy);
						document.getElementById("perch").appendChild(img_closechew);
						
						window.setTimeout(d_idle, 500);
						clear();
						closechew = true;
					}
				}
				
				var d_idle = function() {
					if (muffin_count == 0 && !open) {
						
						var derpy = document.getElementById("derpy");
						derpy.parentNode.removeChild(derpy);
						document.getElementById("perch").appendChild(img_idle);
						
						clear();
						idle = true;
					}
				}
				
				var muffin = function() {
					d_open();
					
					muffin_count += 1;
					
					this.img = newmuffin();
					this.img.style.left = window.innerWidth / 2 - this.img.width / 2 + "px";
					this.img.style.top = "50px";
					document.getElementById("theBody").appendChild(this.img);
					//document.getElementsByClassName('muffin')[0].style['left'] = window.innerWidth / 2 - muffin_img.width / 2 + "px";
					
					this.position = muffin_img.offsetTop;
					this.speed = 0;
					this.acceleration = 1;
					
					var self = this;
					
					this.update = function() {
						self.speed += self.acceleration;
						self.position += self.speed;
						self.img.style.top = self.position + "px";
						
						if (self.position > window.innerHeight - 350) {
							window.clearInterval(self.interval);
							document.getElementById("theBody").removeChild(self.img);
							muffin_count -= 1;
							d_closechew();
						}
					}
					this.interval = window.setInterval(this.update, 25);
				}
				
				
				
			</script>
			<div id="muffinbutton" onmouseover="d_open()" onmouseout="d_close()" onclick="new muffin()"></div>
			<div id="outer">
				<div id="perch">
					<img id="derpy" src="idle.gif" height="464" width="600">
				</div>
			</div>
		</body>
	</html>